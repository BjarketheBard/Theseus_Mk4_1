# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

# Main printer config
[include stepper.cfg]
[include tmc2209.cfg]
#[include extruder.cfg]
#[include heater_bed.cfg]
[include fan.cfg]
[include macro.cfg]
[include KAMP_Settings.cfg]
[include bigtreetech-ebb-canbus-v1.2.cfg]
#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

[force_move] 
enable_force_move: true 

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

#[heater_fan fan1]
#pin: PA3

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

[mcu]
#serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_2E00370008504E5238363120-if00
canbus_uuid: ed4c95b3cf4d

[mcu scanner]
canbus_uuid: 790cae418c52 
#serial: /dev/serial/by-id/usb-Cartographer_614e_32000700124330394D363620-if00
#    adjust to suit your scanner, if using usb change to serial

[scanner]
mcu: scanner            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                         
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: -23                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 1.97465
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc      
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 110, 110    
#    set this to the middle of your bed
speed: 200
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 10, 10
mesh_max: 190, 177
probe_count: 30, 30
algorithm: bicubic

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[adxl345 hotend]
cs_pin: scanner:PA3
spi_bus: spi1

[adxl345 bed]
cs_pin: PC0
spi_software_sclk_pin: PB13
spi_software_miso_pin: PB14
spi_software_mosi_pin: PB15


[resonance_tester]
accel_chip_x: adxl345 hotend
accel_chip_y: adxl345 bed
probe_points:
    125, 125, 20

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_z_velocity: 10
max_z_accel: 120
square_corner_velocity: 10


[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[extruder]
#E3D Revo Hemera XS
#max_extrude_only_distance: 1000.0
#step_pin: PB12
#dir_pin: PB11
#enable_pin: !PA8
#microsteps: 16
#rotation_distance: 8.073476064
#nozzle_diameter: 0.400
#filament_diameter: 1.750
#heater_pin: PC5
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PA1
#control: pid
#pid_Kp: 26.949
#pid_Ki: 1.497
#pid_Kd: 121.269
#min_temp: 0
#max_temp: 300
#pressure_advance: 0
#max_extrude_cross_section: 5

[firmware_retraction]
retract_length: 0.2
retract_speed: 20
unretract_extra_length: 0
unretract_speed: 10

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

#[bltouch]
#sensor_pin: PC13
#control_pin: PC15
#x_offset: 0
#y_offset: -36.65
#z_offset: 1.40


#[bed_mesh]
#speed: 80
#horizontal_move_z: 5
#mesh_min: 5, 0
#mesh_max: 200, 163.35
#probe_count: 5, 5
#mesh_pps: 2, 2
#fade_start: 1
#fade_end: 10
#fade_target: 0
#adaptive_margin: 5

[bed_screws]
screw1: 10, 10
screw2: 194, 10
screw3: 194, 180
screw4: 10, 180

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
min_temp: 0
max_temp: 130

[gcode_arcs]

[filament_switch_sensor switch_sensor]
switch_pin: ^PC2  # switch sensor IO is PA0
pause_on_runout: False
runout_gcode:
    PAUSE  # [pause_resume] is required in printer.cfg
    M117 Filament switch runout
insert_gcode:
    M117 Filament switch inserted

[filament_motion_sensor encoder_sensor]
switch_pin: ^PC3  # motion sensor IO is PC2
detection_length: 2.88  # accuracy of motion sensor 2.88mm
extruder: extruder
pause_on_runout: False
runout_gcode:
    PAUSE  # [pause_resume] is required in printer.cfg
    M117 Filament encoder runout
insert_gcode:
    M117 Filament encoder inserted




[safe_z_home]
home_xy_position: 110, 110 # Change coordinates to the center of your print bed
speed: 50
z_hop: 10                 # Move up 10mm
z_hop_speed: 5


[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

# Proximity switch
#[probe]
#pin: PC15

[neopixel my_neopixel]
pin: PC11
chain_count: 80
initial_RED: 0.2
initial_GREEN: 0.2
initial_BLUE: 0.2



#[neopixel my_neopixel2]
#pin: PC14

#[adxl345]
#cs_pin: PC0
#spi_bus: spi2

[virtual_sdcard]
path: /home/bryan/printer_data/gcodes

[display_status]

[pause_resume]

[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.8004804511442374,
#*# 	2.112474704894231,
#*# 	0.7624126211552706,
#*# 	0.25892166651564424,
#*# 	-0.5223904464990241,
#*# 	0.31093773709763356,
#*# 	1.106747542605254,
#*# 	-0.8629486872965256,
#*# 	-0.594542643944468,
#*# 	0.6380353360954293
#*# model_domain = 3.2919695479189234e-07,3.3118493273046885e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 23.223739
#*# model_offset = 0.00000
#*# model_mode = scan
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.198228, 0.354299, 0.315389, 0.248043, 0.206291, 0.145472, 0.097358, 0.060296, 0.049131, 0.077194, 0.071519, 0.034196, -0.013064, -0.071311, -0.126857, -0.184300, -0.241315, -0.300344, -0.353363, -0.416765, -0.464358, -0.523755, -0.602904, -0.724474, -0.896405, -1.052153, -1.151802, -1.252431, -1.327636, -1.434278
#*# 	  0.251248, 0.481814, 0.472389, 0.425352, 0.373419, 0.334999, 0.288402, 0.245477, 0.204820, 0.162752, 0.123391, 0.077927, 0.030462, -0.035134, -0.087385, -0.141669, -0.197002, -0.249948, -0.304831, -0.358279, -0.403719, -0.458106, -0.525695, -0.595162, -0.679391, -0.774402, -0.842597, -0.927560, -1.010165, -1.094592
#*# 	  0.250198, 0.489999, 0.491214, 0.452196, 0.418449, 0.370609, 0.323969, 0.284642, 0.236477, 0.188806, 0.150110, 0.091927, 0.043002, -0.011744, -0.076090, -0.121560, -0.176034, -0.232695, -0.286120, -0.331975, -0.390722, -0.446346, -0.489606, -0.559276, -0.620978, -0.681054, -0.755247, -0.832792, -0.902955, -0.993484
#*# 	  0.245950, 0.473676, 0.488020, 0.456862, 0.421643, 0.383318, 0.342496, 0.302939, 0.255642, 0.209137, 0.161785, 0.110743, 0.054963, 0.000541, -0.057677, -0.113483, -0.163559, -0.210874, -0.264635, -0.312293, -0.362192, -0.426459, -0.468854, -0.522836, -0.582523, -0.642862, -0.702007, -0.779256, -0.853559, -0.941954
#*# 	  0.238984, 0.464776, 0.484205, 0.448661, 0.427428, 0.383528, 0.343738, 0.307921, 0.259126, 0.213361, 0.169705, 0.116780, 0.066487, 0.003584, -0.049873, -0.101774, -0.148876, -0.206842, -0.254161, -0.314793, -0.353086, -0.408525, -0.458167, -0.507719, -0.566710, -0.618451, -0.686864, -0.748344, -0.826035, -0.911150
#*# 	  0.210964, 0.451443, 0.479214, 0.452664, 0.416749, 0.387736, 0.348112, 0.306087, 0.263751, 0.213932, 0.175004, 0.120516, 0.070655, 0.007361, -0.040894, -0.093840, -0.146020, -0.198832, -0.250257, -0.293741, -0.345260, -0.383871, -0.442133, -0.495013, -0.545290, -0.601628, -0.659274, -0.734015, -0.796910, -0.892001
#*# 	  0.215059, 0.447273, 0.474621, 0.452503, 0.430150, 0.391066, 0.351818, 0.312872, 0.269059, 0.226620, 0.176065, 0.128024, 0.076182, 0.019392, -0.029171, -0.088055, -0.133904, -0.187373, -0.230295, -0.283642, -0.324357, -0.369915, -0.418566, -0.465073, -0.533058, -0.579329, -0.646708, -0.703318, -0.783986, -0.858986
#*# 	  0.205455, 0.450300, 0.484142, 0.458891, 0.430266, 0.394488, 0.359786, 0.321640, 0.275561, 0.235032, 0.181599, 0.133976, 0.083100, 0.024848, -0.015339, -0.070343, -0.113490, -0.167197, -0.228057, -0.259787, -0.308160, -0.353478, -0.399755, -0.457543, -0.503986, -0.560389, -0.621353, -0.689542, -0.759978, -0.833211
#*# 	  0.221686, 0.465727, 0.484127, 0.470495, 0.440871, 0.399451, 0.374399, 0.330720, 0.284920, 0.240565, 0.192758, 0.147140, 0.091684, 0.042857, -0.005861, -0.055490, -0.108692, -0.156209, -0.207763, -0.251241, -0.292096, -0.328765, -0.384268, -0.433088, -0.482237, -0.538985, -0.604981, -0.663716, -0.741963, -0.820746
#*# 	  0.233782, 0.473631, 0.495418, 0.480605, 0.454199, 0.415216, 0.385054, 0.341547, 0.301095, 0.248951, 0.208763, 0.156144, 0.110727, 0.056185, 0.013784, -0.040782, -0.087839, -0.135911, -0.185113, -0.221942, -0.275062, -0.309159, -0.358483, -0.404129, -0.456437, -0.516680, -0.577847, -0.639154, -0.709265, -0.785505
#*# 	  0.239169, 0.486803, 0.506460, 0.490275, 0.463324, 0.430155, 0.392172, 0.356531, 0.309460, 0.268673, 0.215349, 0.173838, 0.124812, 0.078664, 0.030484, -0.023075, -0.071942, -0.113353, -0.160956, -0.206763, -0.250800, -0.293355, -0.336751, -0.386795, -0.434159, -0.499612, -0.547784, -0.628139, -0.685527, -0.772249
#*# 	  0.286146, 0.503991, 0.522966, 0.506600, 0.474768, 0.445689, 0.412624, 0.367949, 0.328794, 0.280972, 0.234633, 0.187159, 0.141284, 0.090709, 0.042189, -0.008285, -0.056413, -0.094836, -0.149793, -0.183122, -0.227611, -0.275721, -0.315750, -0.357942, -0.413818, -0.472419, -0.527870, -0.591648, -0.665632, -0.733351
#*# 	  0.300001, 0.516855, 0.535629, 0.509989, 0.485639, 0.458119, 0.416369, 0.386074, 0.335087, 0.296084, 0.246285, 0.197633, 0.152285, 0.105966, 0.054600, 0.008469, -0.044992, -0.086982, -0.136801, -0.172268, -0.217607, -0.254727, -0.308521, -0.351833, -0.397047, -0.446450, -0.518853, -0.576284, -0.646480, -0.736639
#*# 	  0.290217, 0.527701, 0.540843, 0.528131, 0.497538, 0.464689, 0.430004, 0.393477, 0.349306, 0.306879, 0.255952, 0.208600, 0.163712, 0.115978, 0.068774, 0.012778, -0.030008, -0.075175, -0.119672, -0.162116, -0.196984, -0.246112, -0.286219, -0.330521, -0.384055, -0.438697, -0.487924, -0.565614, -0.617653, -0.721797
#*# 	  0.303728, 0.521423, 0.548876, 0.533537, 0.505295, 0.470329, 0.437819, 0.398001, 0.362873, 0.310392, 0.265197, 0.217711, 0.172352, 0.118782, 0.070385, 0.029259, -0.022661, -0.070876, -0.108340, -0.153038, -0.195656, -0.235118, -0.274036, -0.324611, -0.372219, -0.427953, -0.479928, -0.545116, -0.602903, -0.700237
#*# 	  0.329662, 0.528976, 0.557857, 0.538221, 0.510293, 0.483168, 0.444788, 0.407058, 0.366107, 0.320606, 0.274403, 0.225754, 0.176122, 0.132686, 0.078449, 0.032240, -0.013536, -0.057367, -0.110129, -0.142543, -0.182194, -0.224868, -0.261781, -0.316137, -0.349983, -0.413868, -0.456544, -0.532418, -0.589506, -0.682319
#*# 	  0.342049, 0.539655, 0.564314, 0.543920, 0.513845, 0.494031, 0.455491, 0.411357, 0.374500, 0.327383, 0.289073, 0.235172, 0.188896, 0.134244, 0.084440, 0.032219, -0.009787, -0.053837, -0.101865, -0.142447, -0.180769, -0.223411, -0.267531, -0.302443, -0.356305, -0.394949, -0.450138, -0.520172, -0.582871, -0.673590
#*# 	  0.345743, 0.547432, 0.568625, 0.556512, 0.529450, 0.496757, 0.463602, 0.422411, 0.379803, 0.333895, 0.295642, 0.247973, 0.196626, 0.147933, 0.089337, 0.046737, 0.004579, -0.042010, -0.088357, -0.129927, -0.166655, -0.214115, -0.250515, -0.295796, -0.339406, -0.388139, -0.444860, -0.503152, -0.579609, -0.661796
#*# 	  0.362262, 0.568855, 0.576608, 0.569022, 0.535928, 0.504144, 0.469467, 0.434119, 0.384175, 0.340528, 0.296684, 0.256116, 0.200255, 0.153720, 0.099732, 0.053515, 0.006048, -0.037453, -0.090722, -0.119397, -0.173835, -0.204669, -0.247194, -0.292788, -0.337443, -0.380592, -0.441746, -0.495899, -0.572193, -0.653826
#*# 	  0.373945, 0.572556, 0.589598, 0.569527, 0.543195, 0.512820, 0.477991, 0.435358, 0.395088, 0.343051, 0.297695, 0.252317, 0.213637, 0.155690, 0.107823, 0.057281, 0.015128, -0.031437, -0.081374, -0.116167, -0.162044, -0.192764, -0.246656, -0.284213, -0.337575, -0.381884, -0.428280, -0.500842, -0.564793, -0.654191
#*# 	  0.387088, 0.583381, 0.601040, 0.583356, 0.560841, 0.526881, 0.488173, 0.445000, 0.404066, 0.350112, 0.312319, 0.259122, 0.213936, 0.167876, 0.110476, 0.072349, 0.019608, -0.022551, -0.075982, -0.107499, -0.152431, -0.191596, -0.235404, -0.281068, -0.319378, -0.374790, -0.429995, -0.494451, -0.562780, -0.649217
#*# 	  0.406848, 0.604468, 0.620543, 0.596432, 0.564039, 0.543952, 0.498824, 0.455395, 0.409553, 0.370609, 0.311503, 0.267687, 0.224065, 0.177001, 0.124368, 0.079511, 0.029421, -0.019195, -0.060665, -0.106973, -0.142828, -0.183351, -0.224598, -0.272540, -0.312946, -0.363961, -0.430223, -0.484462, -0.547474, -0.633324
#*# 	  0.434414, 0.622995, 0.630014, 0.609529, 0.581206, 0.547265, 0.503899, 0.470749, 0.421509, 0.376956, 0.329079, 0.276093, 0.231658, 0.184469, 0.140296, 0.086372, 0.037585, -0.004056, -0.055153, -0.099576, -0.141330, -0.178563, -0.217465, -0.257399, -0.309672, -0.362079, -0.418763, -0.475515, -0.545850, -0.622871
#*# 	  0.445109, 0.632820, 0.652131, 0.631350, 0.597907, 0.570853, 0.522686, 0.484935, 0.438251, 0.388962, 0.337017, 0.297692, 0.239855, 0.198412, 0.149916, 0.098081, 0.046243, 0.005100, -0.044369, -0.086087, -0.122634, -0.170257, -0.209074, -0.250515, -0.294089, -0.359539, -0.413326, -0.478920, -0.540117, -0.625480
#*# 	  0.458669, 0.652911, 0.648451, 0.641085, 0.605618, 0.570762, 0.529347, 0.495917, 0.442902, 0.394718, 0.345502, 0.299161, 0.246472, 0.200828, 0.155143, 0.107561, 0.058152, 0.006401, -0.041273, -0.081369, -0.124023, -0.157404, -0.208728, -0.250898, -0.296218, -0.351005, -0.408451, -0.474790, -0.545158, -0.629679
#*# 	  0.470613, 0.666467, 0.664217, 0.647171, 0.622588, 0.581394, 0.542406, 0.498959, 0.448892, 0.398941, 0.352997, 0.307167, 0.256912, 0.208878, 0.156052, 0.115427, 0.063463, 0.012280, -0.035502, -0.076323, -0.113657, -0.156194, -0.201262, -0.249068, -0.305627, -0.346047, -0.410420, -0.474335, -0.536883, -0.620046
#*# 	  0.493635, 0.665224, 0.680073, 0.664888, 0.628433, 0.581241, 0.546137, 0.506006, 0.456485, 0.404080, 0.357681, 0.312123, 0.259077, 0.207819, 0.154914, 0.110086, 0.061381, 0.012487, -0.034280, -0.078071, -0.113391, -0.155791, -0.200179, -0.250992, -0.300222, -0.358301, -0.414919, -0.478484, -0.546826, -0.633168
#*# 	  0.505113, 0.698732, 0.703124, 0.676087, 0.645255, 0.602005, 0.562076, 0.519574, 0.468269, 0.424124, 0.372881, 0.322108, 0.271824, 0.223075, 0.165535, 0.121505, 0.071994, 0.030368, -0.029481, -0.069778, -0.110242, -0.155795, -0.198741, -0.243062, -0.287705, -0.346962, -0.410574, -0.471006, -0.535913, -0.609391
#*# 	  0.520458, 0.697689, 0.700029, 0.676070, 0.647885, 0.598854, 0.558306, 0.512659, 0.462955, 0.418894, 0.360544, 0.319436, 0.265837, 0.219134, 0.163540, 0.114453, 0.064972, 0.017263, -0.023484, -0.067262, -0.115686, -0.161216, -0.210720, -0.249097, -0.308175, -0.348907, -0.414963, -0.481239, -0.551646, -0.634716
#*# 	  0.559670, 0.705723, 0.705494, 0.683071, 0.644545, 0.604003, 0.562636, 0.516677, 0.471054, 0.419050, 0.369487, 0.316666, 0.270538, 0.214896, 0.162962, 0.110829, 0.066593, 0.009764, -0.027499, -0.074114, -0.115154, -0.162472, -0.205753, -0.255685, -0.308637, -0.359737, -0.417899, -0.487868, -0.545896, -0.636616
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 190.0
#*# min_y = 10.0
#*# max_y = 177.0
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 25.6
#*# shaper_type_y = mzv
#*# shaper_freq_y = 28.8
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 34.233
#*# pid_ki = 3.741
#*# pid_kd = 78.309
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 75.491
#*# pid_ki = 1.328
#*# pid_kd = 1072.913
#*#
#*# [scanner]
#*# mode = scan
