# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

# Main printer config
[include stepper.cfg]
[include tmc2209.cfg]
#[include extruder.cfg]
#[include heater_bed.cfg]
[include fan.cfg]
[include macro.cfg]
[include KAMP_Settings.cfg]
[include bigtreetech-ebb-canbus-v1.2.cfg]
#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

#[heater_fan fan1]
#pin: PA3

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

[mcu]
#serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_2E00370008504E5238363120-if00
canbus_uuid: ed4c95b3cf4d

[mcu scanner]
canbus_uuid: 790cae418c52 
#serial: /dev/serial/by-id/usb-Cartographer_614e_32000700124330394D363620-if00
#    adjust to suit your scanner, if using usb change to serial

[scanner]
mcu: scanner            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                         
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: -23                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.00764
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc      
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 110, 110    
#    set this to the middle of your bed
speed: 120
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 20, 5
mesh_max: 180, 177
probe_count: 30, 30
algorithm: bicubic

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[adxl345 hotend]
cs_pin: scanner:PA3
spi_bus: spi1

[adxl345 bed]
cs_pin: PC0
spi_software_sclk_pin: PB13
spi_software_miso_pin: PB14
spi_software_mosi_pin: PB15


[resonance_tester]
accel_chip_x: adxl345 hotend
accel_chip_y: adxl345 bed
probe_points:
    125, 125, 20

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_z_velocity: 10
max_z_accel: 120
square_corner_velocity: 10


[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[extruder]
#E3D Revo Hemera XS
#max_extrude_only_distance: 1000.0
#step_pin: PB12
#dir_pin: PB11
#enable_pin: !PA8
#microsteps: 16
#rotation_distance: 8.073476064
#nozzle_diameter: 0.400
#filament_diameter: 1.750
#heater_pin: PC5
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PA1
#control: pid
#pid_Kp: 26.949
#pid_Ki: 1.497
#pid_Kd: 121.269
#min_temp: 0
#max_temp: 300
#pressure_advance: 0
#max_extrude_cross_section: 5

[firmware_retraction]
retract_length: 0.2
retract_speed: 20
unretract_extra_length: 0
unretract_speed: 10

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

#[bltouch]
#sensor_pin: PC13
#control_pin: PC15
#x_offset: 0
#y_offset: -36.65
#z_offset: 1.40


#[bed_mesh]
#speed: 80
#horizontal_move_z: 5
#mesh_min: 5, 0
#mesh_max: 200, 163.35
#probe_count: 5, 5
#mesh_pps: 2, 2
#fade_start: 1
#fade_end: 10
#fade_target: 0
#adaptive_margin: 5

[bed_screws]
screw1: 10, 10
screw2: 194, 10
screw3: 194, 180
screw4: 10, 180

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
min_temp: 0
max_temp: 130

[gcode_arcs]

[filament_switch_sensor switch_sensor]
switch_pin: ^PC2  # switch sensor IO is PA0
pause_on_runout: False
runout_gcode:
    PAUSE  # [pause_resume] is required in printer.cfg
    M117 Filament switch runout
insert_gcode:
    M117 Filament switch inserted

[filament_motion_sensor encoder_sensor]
switch_pin: ^PC3  # motion sensor IO is PC2
detection_length: 2.88  # accuracy of motion sensor 2.88mm
extruder: extruder
pause_on_runout: False
runout_gcode:
    PAUSE  # [pause_resume] is required in printer.cfg
    M117 Filament encoder runout
insert_gcode:
    M117 Filament encoder inserted




[safe_z_home]
home_xy_position: 110, 110 # Change coordinates to the center of your print bed
speed: 50
z_hop: 10                 # Move up 10mm
z_hop_speed: 5


[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

# Proximity switch
#[probe]
#pin: PC15

[neopixel my_neopixel]
pin: PC11
chain_count: 80
initial_RED: 0.2
initial_GREEN: 0.2
initial_BLUE: 0.2



#[neopixel my_neopixel2]
#pin: PC14

#[adxl345]
#cs_pin: PC0
#spi_bus: spi2

[virtual_sdcard]
path: /home/bryan/printer_data/gcodes

[display_status]

[pause_resume]

[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.6729884310467031,
#*# 	2.0443196723491583,
#*# 	0.7271527320605512,
#*# 	0.16495697874108267,
#*# 	-0.1444690340446165,
#*# 	0.890670367313759,
#*# 	0.7357790831508215,
#*# 	-1.3905615640289337,
#*# 	-0.43739481506348116,
#*# 	0.7480512161239498
#*# model_domain = 3.290151454891589e-07,3.3116151654665103e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 29.192744
#*# model_offset = 0.00000
#*# model_mode = scan
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.075653, 0.074904, 0.050702, 0.026516, 0.013150, 0.003880, 0.006215, 0.018937, 0.016506, 0.001628, -0.015426, -0.032274, -0.050624, -0.071696, -0.094587, -0.116393, -0.141414, -0.165106, -0.189910, -0.211257, -0.235800, -0.256675, -0.279265, -0.307451, -0.326930, -0.349688, -0.374749, -0.416517, -0.481004, -0.534998
#*# 	0.141111, 0.121304, 0.104371, 0.090858, 0.075315, 0.061922, 0.050390, 0.040373, 0.025843, 0.012733, -0.005294, -0.023431, -0.040272, -0.063434, -0.082207, -0.109260, -0.129147, -0.155571, -0.180101, -0.199088, -0.223862, -0.246466, -0.267604, -0.290627, -0.319031, -0.340247, -0.361760, -0.385782, -0.427638, -0.459410
#*# 	0.140749, 0.128862, 0.112653, 0.104851, 0.088007, 0.075748, 0.063863, 0.052457, 0.037334, 0.024704, 0.008384, -0.011485, -0.027006, -0.049426, -0.070014, -0.092819, -0.116305, -0.138872, -0.163849, -0.187846, -0.206087, -0.230422, -0.252062, -0.274885, -0.297734, -0.317889, -0.350942, -0.375184, -0.396326, -0.428258
#*# 	0.130676, 0.123028, 0.114705, 0.102276, 0.095931, 0.083046, 0.072654, 0.064237, 0.051355, 0.036588, 0.022990, 0.003247, -0.012108, -0.031661, -0.056144, -0.077273, -0.103225, -0.120810, -0.146604, -0.165602, -0.192911, -0.215182, -0.236129, -0.261587, -0.282863, -0.303101, -0.325430, -0.349962, -0.378459, -0.406913
#*# 	0.127180, 0.130324, 0.114290, 0.110867, 0.099833, 0.090021, 0.081270, 0.070043, 0.060643, 0.049330, 0.036761, 0.020906, 0.004127, -0.019206, -0.039369, -0.064857, -0.087485, -0.109334, -0.129897, -0.157122, -0.174884, -0.198088, -0.220614, -0.242396, -0.257707, -0.286058, -0.307399, -0.327688, -0.356666, -0.387912
#*# 	0.118418, 0.119072, 0.115058, 0.113912, 0.104470, 0.093086, 0.089496, 0.082389, 0.068508, 0.058430, 0.046843, 0.030886, 0.014452, -0.009345, -0.032064, -0.052630, -0.074493, -0.100402, -0.121043, -0.140460, -0.163123, -0.186201, -0.206521, -0.230401, -0.243709, -0.265687, -0.289814, -0.317049, -0.339974, -0.371592
#*# 	0.120173, 0.123824, 0.118518, 0.111747, 0.106072, 0.100892, 0.091856, 0.085216, 0.072012, 0.058988, 0.049188, 0.030234, 0.017266, -0.004068, -0.025116, -0.046991, -0.067019, -0.088849, -0.110144, -0.129470, -0.151966, -0.168683, -0.189196, -0.211867, -0.235805, -0.250841, -0.274085, -0.302707, -0.326295, -0.353585
#*# 	0.115630, 0.115040, 0.113140, 0.110233, 0.105412, 0.099199, 0.090144, 0.081867, 0.070648, 0.060080, 0.043232, 0.030939, 0.015993, -0.001806, -0.026599, -0.044802, -0.063795, -0.081809, -0.104661, -0.123997, -0.145752, -0.165670, -0.184704, -0.206820, -0.227937, -0.246700, -0.269884, -0.291941, -0.316063, -0.343289
#*# 	0.113476, 0.114370, 0.106697, 0.103138, 0.096242, 0.092916, 0.086521, 0.078643, 0.062931, 0.053311, 0.040215, 0.026804, 0.009239, -0.010181, -0.025169, -0.043570, -0.066164, -0.082599, -0.104676, -0.123119, -0.144252, -0.166102, -0.183766, -0.205544, -0.225189, -0.244202, -0.265096, -0.290938, -0.312466, -0.341088
#*# 	0.102459, 0.098158, 0.103110, 0.099657, 0.093382, 0.085621, 0.080189, 0.070368, 0.060667, 0.044642, 0.032762, 0.022158, 0.002602, -0.013353, -0.031854, -0.049871, -0.066119, -0.085320, -0.100929, -0.123777, -0.141211, -0.162838, -0.180133, -0.200919, -0.225290, -0.239131, -0.262383, -0.278063, -0.304661, -0.336127
#*# 	0.099375, 0.102227, 0.101539, 0.101625, 0.096662, 0.092775, 0.082949, 0.074989, 0.062128, 0.050728, 0.035112, 0.019429, 0.008108, -0.011503, -0.029402, -0.046927, -0.064294, -0.078537, -0.097931, -0.118387, -0.134986, -0.156012, -0.172348, -0.195753, -0.210220, -0.228481, -0.250134, -0.274876, -0.294730, -0.324512
#*# 	0.110078, 0.111679, 0.108469, 0.112718, 0.101995, 0.102281, 0.095596, 0.083259, 0.071508, 0.056276, 0.044191, 0.030431, 0.018858, -0.002821, -0.017811, -0.040536, -0.054824, -0.068260, -0.086801, -0.110278, -0.125349, -0.148071, -0.158637, -0.181698, -0.196823, -0.219963, -0.236367, -0.251169, -0.282175, -0.311038
#*# 	0.126701, 0.129205, 0.131708, 0.128970, 0.123155, 0.122487, 0.116791, 0.104963, 0.091724, 0.078309, 0.063285, 0.044058, 0.033074, 0.018023, -0.001137, -0.021168, -0.038721, -0.056602, -0.076697, -0.089604, -0.109371, -0.122769, -0.144391, -0.162051, -0.177250, -0.202140, -0.218100, -0.231116, -0.256818, -0.286816
#*# 	0.149934, 0.156876, 0.160617, 0.155531, 0.153958, 0.150985, 0.142961, 0.135481, 0.118117, 0.103787, 0.086269, 0.068010, 0.057797, 0.035470, 0.021650, 0.004184, -0.017376, -0.035339, -0.056026, -0.074960, -0.088230, -0.102604, -0.122806, -0.142544, -0.156873, -0.175396, -0.196986, -0.212400, -0.237354, -0.264945
#*# 	0.175099, 0.177224, 0.180857, 0.175190, 0.176719, 0.173099, 0.170313, 0.154891, 0.143950, 0.129195, 0.111391, 0.095890, 0.078650, 0.060290, 0.041284, 0.023423, 0.001174, -0.016100, -0.032714, -0.054234, -0.069334, -0.085003, -0.102461, -0.119540, -0.133841, -0.156414, -0.171974, -0.192760, -0.213380, -0.236308
#*# 	0.193674, 0.197793, 0.196450, 0.197068, 0.192148, 0.190065, 0.186337, 0.176498, 0.161544, 0.152682, 0.131513, 0.115701, 0.098036, 0.076277, 0.058655, 0.039676, 0.015837, -0.002715, -0.021708, -0.034569, -0.054932, -0.072747, -0.091157, -0.102676, -0.120786, -0.142575, -0.153545, -0.182329, -0.194215, -0.218825
#*# 	0.200426, 0.202974, 0.206340, 0.204570, 0.203924, 0.200105, 0.196978, 0.186596, 0.170679, 0.157583, 0.143415, 0.121894, 0.108105, 0.085539, 0.062573, 0.044302, 0.022990, 0.007783, -0.010737, -0.030184, -0.042968, -0.063280, -0.077213, -0.098646, -0.114321, -0.132063, -0.148243, -0.167083, -0.195740, -0.217641
#*# 	0.210803, 0.215898, 0.215625, 0.214306, 0.211192, 0.209699, 0.202160, 0.193914, 0.177098, 0.165329, 0.148020, 0.127687, 0.113917, 0.088471, 0.069352, 0.047066, 0.026962, 0.012468, -0.006078, -0.026597, -0.041296, -0.059738, -0.079927, -0.098898, -0.115556, -0.129522, -0.149358, -0.168738, -0.191479, -0.213641
#*# 	0.215866, 0.220341, 0.222668, 0.219878, 0.217064, 0.214779, 0.202403, 0.193418, 0.177845, 0.165743, 0.151638, 0.130472, 0.110693, 0.094018, 0.069595, 0.051475, 0.032490, 0.013523, -0.004400, -0.021886, -0.044062, -0.059653, -0.081804, -0.097345, -0.115016, -0.132369, -0.150944, -0.173153, -0.186576, -0.216898
#*# 	0.227199, 0.232416, 0.230845, 0.233214, 0.228087, 0.218876, 0.208207, 0.200791, 0.182404, 0.169732, 0.153894, 0.132654, 0.115937, 0.095132, 0.073831, 0.054226, 0.034712, 0.019616, -0.000195, -0.019678, -0.039495, -0.059082, -0.079379, -0.096125, -0.113035, -0.132921, -0.150373, -0.172343, -0.187246, -0.216043
#*# 	0.241886, 0.242500, 0.244733, 0.239501, 0.233805, 0.223843, 0.214261, 0.202417, 0.188286, 0.172767, 0.154933, 0.135343, 0.119388, 0.101578, 0.077250, 0.063980, 0.042503, 0.026690, 0.002625, -0.018715, -0.036891, -0.061971, -0.079666, -0.096924, -0.115107, -0.129002, -0.151817, -0.170609, -0.187647, -0.213390
#*# 	0.259346, 0.263925, 0.261821, 0.256667, 0.244216, 0.236294, 0.225215, 0.218248, 0.194655, 0.181025, 0.159184, 0.143101, 0.129000, 0.107722, 0.087340, 0.070619, 0.049776, 0.033989, 0.011940, -0.012989, -0.034997, -0.058123, -0.071964, -0.094746, -0.110589, -0.126937, -0.147732, -0.163069, -0.185129, -0.213756
#*# 	0.264298, 0.265537, 0.262985, 0.258831, 0.246037, 0.237919, 0.226938, 0.215803, 0.196847, 0.179319, 0.162666, 0.142306, 0.126038, 0.102610, 0.090411, 0.071530, 0.055561, 0.035155, 0.011088, -0.009961, -0.036044, -0.057154, -0.074545, -0.092150, -0.112288, -0.129191, -0.143589, -0.171351, -0.192610, -0.213012
#*# 	0.287225, 0.277521, 0.281387, 0.271044, 0.259065, 0.254030, 0.241278, 0.228799, 0.209968, 0.193260, 0.173320, 0.157147, 0.137500, 0.120359, 0.102639, 0.084901, 0.061689, 0.043438, 0.022177, -0.000664, -0.023545, -0.047477, -0.065884, -0.082947, -0.104380, -0.119421, -0.133825, -0.158424, -0.186468, -0.212579
#*# 	0.307427, 0.304772, 0.302150, 0.290348, 0.281459, 0.271178, 0.260892, 0.248191, 0.227177, 0.208310, 0.189131, 0.171337, 0.152198, 0.135234, 0.116245, 0.099344, 0.081153, 0.059097, 0.036095, 0.012730, -0.010634, -0.032910, -0.050579, -0.070068, -0.089261, -0.103408, -0.125211, -0.147015, -0.173756, -0.200669
#*# 	0.340529, 0.329378, 0.325468, 0.315011, 0.303128, 0.292162, 0.281289, 0.264003, 0.245079, 0.227609, 0.209940, 0.189716, 0.173934, 0.152024, 0.133010, 0.115779, 0.097214, 0.075288, 0.051505, 0.026672, 0.004963, -0.018780, -0.035236, -0.054957, -0.072215, -0.092358, -0.117528, -0.138298, -0.158088, -0.190228
#*# 	0.368051, 0.362254, 0.353592, 0.346952, 0.332577, 0.320747, 0.308153, 0.288066, 0.271932, 0.249547, 0.232759, 0.215000, 0.193538, 0.173942, 0.156854, 0.132284, 0.110842, 0.091487, 0.067509, 0.039893, 0.020801, -0.001931, -0.017826, -0.035752, -0.054479, -0.079548, -0.100090, -0.124565, -0.149333, -0.177496
#*# 	0.403436, 0.389137, 0.381301, 0.371614, 0.355851, 0.339070, 0.325275, 0.305623, 0.291163, 0.274695, 0.249453, 0.230625, 0.213286, 0.189852, 0.170846, 0.145284, 0.123036, 0.101885, 0.074906, 0.051895, 0.033082, 0.014383, -0.009972, -0.021411, -0.049881, -0.065734, -0.085112, -0.116450, -0.141710, -0.171228
#*# 	0.414471, 0.404649, 0.398564, 0.382721, 0.368869, 0.352193, 0.334086, 0.317931, 0.298013, 0.276785, 0.259976, 0.239647, 0.219183, 0.194875, 0.175295, 0.149000, 0.125598, 0.102915, 0.082638, 0.061531, 0.043271, 0.021778, 0.002225, -0.017655, -0.044033, -0.063826, -0.091180, -0.112558, -0.142631, -0.168150
#*# 	0.426755, 0.419451, 0.400856, 0.383871, 0.369287, 0.354006, 0.337658, 0.320752, 0.297697, 0.279727, 0.259118, 0.236951, 0.218418, 0.193354, 0.169932, 0.145499, 0.119591, 0.098438, 0.074964, 0.053470, 0.036787, 0.012135, -0.007094, -0.029466, -0.046160, -0.073513, -0.096961, -0.116639, -0.152998, -0.182000
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 170.0
#*# min_y = 5.0
#*# max_y = 177.0
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 25.6
#*# shaper_type_y = mzv
#*# shaper_freq_y = 28.8
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 34.233
#*# pid_ki = 3.741
#*# pid_kd = 78.309
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 75.491
#*# pid_ki = 1.328
#*# pid_kd = 1072.913
