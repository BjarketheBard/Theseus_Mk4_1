# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

# Main printer config
[include stepper.cfg]
[include tmc2209.cfg]
#[include extruder.cfg]
#[include heater_bed.cfg]
[include fan.cfg]
[include macro.cfg]
[include KAMP_Settings.cfg]
[include bigtreetech-ebb-canbus-v1.2.cfg]
#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

[force_move] 
enable_force_move: true 

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

#[heater_fan fan1]
#pin: PA3

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

[mcu]
#serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_2E00370008504E5238363120-if00
canbus_uuid: ed4c95b3cf4d

[mcu rpi]
serial: /tmp/klipper_host_mcu

[mcu scanner]
canbus_uuid: 790cae418c52 
#serial: /dev/serial/by-id/usb-Cartographer_614e_32000700124330394D363620-if00
#    adjust to suit your scanner, if using usb change to serial

[scanner]
mcu: scanner            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                         
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: -23                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 1.97465
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc      
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 110, 110    
#    set this to the middle of your bed
speed: 200
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 10, 10
mesh_max: 190, 177
probe_count: 30, 30
algorithm: bicubic

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[adxl345 hotend]
cs_pin: scanner:PA3
spi_bus: spi1

[adxl345 bed]
cs_pin: PC0
spi_software_sclk_pin: PB13
spi_software_miso_pin: PB14
spi_software_mosi_pin: PB15


[resonance_tester]
accel_chip_x: adxl345 hotend
accel_chip_y: adxl345 bed
probe_points:
    125, 125, 20

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_z_velocity: 10
max_z_accel: 120
square_corner_velocity: 10


[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[extruder]
#E3D Revo Hemera XS
#max_extrude_only_distance: 1000.0
#step_pin: PB12
#dir_pin: PB11
#enable_pin: !PA8
#microsteps: 16
#rotation_distance: 8.073476064
#nozzle_diameter: 0.400
#filament_diameter: 1.750
#heater_pin: PC5
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PA1
#control: pid
#pid_Kp: 26.949
#pid_Ki: 1.497
#pid_Kd: 121.269
#min_temp: 0
#max_temp: 300
#pressure_advance: 0
#max_extrude_cross_section: 5

[firmware_retraction]
retract_length: 0.2
retract_speed: 20
unretract_extra_length: 0
unretract_speed: 10

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

#[bltouch]
#sensor_pin: PC13
#control_pin: PC15
#x_offset: 0
#y_offset: -36.65
#z_offset: 1.40


#[bed_mesh]
#speed: 80
#horizontal_move_z: 5
#mesh_min: 5, 0
#mesh_max: 200, 163.35
#probe_count: 5, 5
#mesh_pps: 2, 2
#fade_start: 1
#fade_end: 10
#fade_target: 0
#adaptive_margin: 5

[bed_screws]
screw1: 10, 10
screw2: 194, 10
screw3: 194, 180
screw4: 10, 180

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
min_temp: 0
max_temp: 130

[gcode_arcs]

[filament_switch_sensor switch_sensor]
switch_pin: ^PC2  # switch sensor IO is PA0
pause_on_runout: False
runout_gcode:
    PAUSE  # [pause_resume] is required in printer.cfg
    M117 Filament switch runout
insert_gcode:
    M117 Filament switch inserted

[filament_motion_sensor encoder_sensor]
switch_pin: ^PC3  # motion sensor IO is PC2
detection_length: 2.88  # accuracy of motion sensor 2.88mm
extruder: extruder
pause_on_runout: False
runout_gcode:
    PAUSE  # [pause_resume] is required in printer.cfg
    M117 Filament encoder runout
insert_gcode:
    M117 Filament encoder inserted




[safe_z_home]
home_xy_position: 110, 110 # Change coordinates to the center of your print bed
speed: 50
z_hop: 10                 # Move up 10mm
z_hop_speed: 5


[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

# Proximity switch
#[probe]
#pin: PC15

[neopixel my_neopixel]
pin: PC11
chain_count: 80
initial_RED: 0.2
initial_GREEN: 0.2
initial_BLUE: 0.2



#[neopixel my_neopixel2]
#pin: PC14

#[adxl345]
#cs_pin: PC0
#spi_bus: spi2

[virtual_sdcard]
path: /home/bryan/printer_data/gcodes

[display_status]

[pause_resume]

[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.793745003010178,
#*# 	  2.1438239435696866,
#*# 	  0.697233814933811,
#*# 	  -0.11097290163248213,
#*# 	  -0.016813310229317136,
#*# 	  1.655038549141379,
#*# 	  0.39394007676507875,
#*# 	  -2.65769405718046,
#*# 	  -0.3119108514496801,
#*# 	  1.427889727927884
#*# model_domain = 3.290361671419674e-07,3.311519936378306e-07
#*# model_range = 0.100000,4.999520
#*# model_temp = 29.744098
#*# model_offset = 0.44000
#*# model_mode = scan
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.436965, -0.200685, -0.170221, -0.173679, -0.161428, -0.169578, -0.163206, -0.150321, -0.087666, -0.007137, 0.038134, 0.052499, 0.058468, 0.048609, 0.043158, 0.039253, 0.025502, 0.018648, 0.009447, 0.006095, 0.001525, -0.008100, -0.035523, -0.095551, -0.222739, -0.309685, -0.365940, -0.399841, -0.430822, -0.477247
#*# 	-0.352478, -0.043266, 0.005496, 0.028235, 0.021710, 0.035680, 0.039790, 0.044480, 0.060753, 0.073257, 0.084655, 0.085565, 0.085067, 0.073919, 0.068623, 0.060263, 0.057983, 0.050385, 0.036790, 0.031887, 0.028988, 0.022894, 0.010345, -0.009134, -0.048928, -0.080552, -0.119074, -0.141603, -0.175736, -0.231205
#*# 	-0.335697, -0.033003, 0.030311, 0.052750, 0.069030, 0.065116, 0.083359, 0.080763, 0.087490, 0.093861, 0.090540, 0.097491, 0.087495, 0.074437, 0.064175, 0.063622, 0.051257, 0.054011, 0.031597, 0.031773, 0.033508, 0.025857, 0.015696, 0.006230, -0.011157, -0.035501, -0.050274, -0.065025, -0.109769, -0.151104
#*# 	-0.371012, -0.033116, 0.029105, 0.059209, 0.073449, 0.081550, 0.090900, 0.095183, 0.097925, 0.095527, 0.100668, 0.099758, 0.088170, 0.079171, 0.068995, 0.061447, 0.058516, 0.046730, 0.033808, 0.035235, 0.033541, 0.031182, 0.022739, 0.021044, 0.003859, -0.011208, -0.028581, -0.044226, -0.091658, -0.136488
#*# 	-0.386426, -0.058549, 0.019899, 0.050278, 0.058285, 0.078460, 0.087188, 0.091553, 0.095050, 0.092492, 0.095356, 0.093000, 0.079441, 0.071857, 0.066395, 0.053508, 0.046757, 0.038897, 0.033986, 0.028949, 0.031798, 0.025199, 0.023427, 0.012974, 0.004375, -0.009697, -0.023469, -0.057250, -0.074678, -0.133136
#*# 	-0.404716, -0.063909, 0.015163, 0.047210, 0.059350, 0.063025, 0.083870, 0.084913, 0.095401, 0.093822, 0.087099, 0.085483, 0.080246, 0.064484, 0.062015, 0.045325, 0.046592, 0.032376, 0.035403, 0.028165, 0.029416, 0.027430, 0.017347, 0.014563, 0.004499, -0.007360, -0.026546, -0.051703, -0.087394, -0.129687
#*# 	-0.400794, -0.072049, -0.001968, 0.039079, 0.047419, 0.058932, 0.071785, 0.084414, 0.085692, 0.084493, 0.084754, 0.074570, 0.074769, 0.054831, 0.054779, 0.042460, 0.031785, 0.027277, 0.024150, 0.023077, 0.024287, 0.027010, 0.014590, 0.015679, 0.003727, -0.011490, -0.033109, -0.047292, -0.087692, -0.131930
#*# 	-0.395069, -0.084575, 0.011915, 0.036945, 0.045983, 0.061249, 0.070520, 0.083872, 0.082399, 0.080854, 0.082467, 0.069817, 0.068578, 0.056496, 0.051539, 0.047740, 0.037341, 0.032098, 0.020646, 0.024195, 0.026468, 0.029521, 0.017743, 0.017589, 0.006368, -0.009235, -0.033910, -0.057666, -0.087121, -0.125099
#*# 	-0.393793, -0.061451, 0.010368, 0.042115, 0.057371, 0.066216, 0.082045, 0.088888, 0.089835, 0.079909, 0.080683, 0.072232, 0.065232, 0.056053, 0.056433, 0.041727, 0.040153, 0.034844, 0.027358, 0.029196, 0.035684, 0.034059, 0.024920, 0.023996, 0.012559, -0.006848, -0.022258, -0.046987, -0.076738, -0.124781
#*# 	-0.379120, -0.062204, 0.014333, 0.045132, 0.060252, 0.072504, 0.080751, 0.085931, 0.086842, 0.085297, 0.078329, 0.074763, 0.065015, 0.061280, 0.057324, 0.047306, 0.042691, 0.034142, 0.031634, 0.035217, 0.041465, 0.039187, 0.036537, 0.029416, 0.008765, -0.010701, -0.025017, -0.051019, -0.084080, -0.125523
#*# 	-0.393025, -0.064238, 0.023175, 0.042390, 0.077363, 0.075100, 0.081032, 0.088352, 0.085706, 0.083124, 0.075993, 0.074465, 0.064863, 0.054682, 0.054373, 0.044026, 0.045248, 0.034264, 0.037409, 0.027196, 0.038494, 0.037641, 0.036406, 0.026025, 0.016719, -0.006900, -0.021807, -0.046129, -0.078644, -0.123542
#*# 	-0.382825, -0.047690, 0.022798, 0.053899, 0.068449, 0.073177, 0.087071, 0.094641, 0.091279, 0.090274, 0.084302, 0.078088, 0.073680, 0.061593, 0.053116, 0.051241, 0.041616, 0.042334, 0.035402, 0.035870, 0.039283, 0.042496, 0.045259, 0.025189, 0.014695, -0.005137, -0.023290, -0.045965, -0.073874, -0.121696
#*# 	-0.369414, -0.056926, 0.026701, 0.052448, 0.067028, 0.084182, 0.090457, 0.088704, 0.094167, 0.086862, 0.082443, 0.075519, 0.068716, 0.062490, 0.051579, 0.050901, 0.040419, 0.040206, 0.029254, 0.032091, 0.033964, 0.033920, 0.028141, 0.022649, 0.004850, -0.012618, -0.033886, -0.049661, -0.088257, -0.121491
#*# 	-0.363997, -0.052256, 0.032850, 0.048601, 0.074222, 0.084738, 0.090087, 0.094879, 0.094873, 0.085237, 0.083613, 0.075677, 0.064453, 0.058819, 0.046635, 0.042696, 0.037111, 0.028255, 0.024962, 0.027985, 0.024144, 0.022392, 0.026422, 0.019099, 0.010163, -0.006483, -0.030955, -0.048569, -0.084547, -0.126281
#*# 	-0.334796, -0.038708, 0.028860, 0.062257, 0.076986, 0.076121, 0.094857, 0.089728, 0.095185, 0.086794, 0.080994, 0.071887, 0.063227, 0.053807, 0.049790, 0.033018, 0.032067, 0.023101, 0.023700, 0.021484, 0.021067, 0.024395, 0.022069, 0.013116, 0.010419, -0.010709, -0.037053, -0.056649, -0.103056, -0.127894
#*# 	-0.345884, -0.049055, 0.025266, 0.058724, 0.076310, 0.077325, 0.092927, 0.094383, 0.092881, 0.084494, 0.077930, 0.064088, 0.061305, 0.042583, 0.039897, 0.032412, 0.023701, 0.020041, 0.010667, 0.011507, 0.013394, 0.015913, 0.011138, 0.005308, -0.004716, -0.026511, -0.040966, -0.071649, -0.092341, -0.148463
#*# 	-0.334715, -0.036331, 0.033589, 0.062448, 0.076356, 0.080858, 0.090018, 0.089966, 0.084737, 0.084003, 0.073764, 0.066199, 0.053248, 0.046042, 0.034377, 0.024524, 0.015664, 0.009227, -0.001956, 0.005208, -0.000181, 0.007037, 0.001311, 0.001583, -0.011677, -0.027851, -0.047673, -0.077378, -0.100271, -0.152366
#*# 	-0.338145, -0.027567, 0.028327, 0.061519, 0.064147, 0.080834, 0.078865, 0.088230, 0.074958, 0.074914, 0.064650, 0.055703, 0.048474, 0.033877, 0.021726, 0.012503, 0.009456, -0.001953, -0.004882, -0.005195, -0.004525, -0.002610, -0.014421, -0.016077, -0.026920, -0.044038, -0.061926, -0.094830, -0.118301, -0.164482
#*# 	-0.327071, -0.030469, 0.035815, 0.058183, 0.075142, 0.076684, 0.079607, 0.084555, 0.082535, 0.074206, 0.063930, 0.053314, 0.041920, 0.029709, 0.023910, 0.005710, 0.001382, -0.013249, -0.012127, -0.019958, -0.009230, -0.025881, -0.022594, -0.026994, -0.037878, -0.055402, -0.077036, -0.105404, -0.144725, -0.176226
#*# 	-0.309258, -0.040157, 0.038516, 0.061436, 0.074081, 0.079013, 0.083275, 0.082215, 0.071226, 0.063593, 0.058524, 0.042856, 0.034161, 0.021596, 0.011102, -0.005889, -0.009392, -0.021312, -0.024512, -0.035733, -0.022422, -0.036095, -0.033573, -0.045537, -0.052569, -0.074014, -0.090604, -0.127219, -0.150190, -0.199295
#*# 	-0.310865, -0.023107, 0.040389, 0.061157, 0.075681, 0.072046, 0.084453, 0.075272, 0.075075, 0.064435, 0.056205, 0.042447, 0.028951, 0.014037, 0.004944, -0.008223, -0.015627, -0.032440, -0.034882, -0.038346, -0.040391, -0.044576, -0.051815, -0.059247, -0.064762, -0.089473, -0.108861, -0.132778, -0.177576, -0.221069
#*# 	-0.305338, -0.013430, 0.044456, 0.067250, 0.080546, 0.076924, 0.084305, 0.080265, 0.071863, 0.063011, 0.048061, 0.039971, 0.030912, 0.014445, 0.006158, -0.011701, -0.024106, -0.032605, -0.041390, -0.043787, -0.055217, -0.056963, -0.058189, -0.070606, -0.077727, -0.098745, -0.123010, -0.152701, -0.181341, -0.229114
#*# 	-0.296215, -0.003899, 0.060754, 0.079754, 0.088311, 0.086080, 0.090158, 0.079884, 0.070614, 0.058833, 0.053172, 0.035052, 0.025691, 0.010945, -0.001367, -0.019826, -0.023989, -0.040324, -0.052751, -0.056589, -0.064172, -0.069630, -0.071035, -0.084608, -0.094946, -0.109812, -0.130694, -0.164963, -0.200154, -0.240759
#*# 	-0.289744, -0.001203, 0.057291, 0.080958, 0.084801, 0.090614, 0.093132, 0.083551, 0.065969, 0.058122, 0.047249, 0.033754, 0.024921, 0.004292, -0.004913, -0.022458, -0.037886, -0.048566, -0.063000, -0.065160, -0.067108, -0.070672, -0.080479, -0.094101, -0.106042, -0.120624, -0.147119, -0.183623, -0.214594, -0.269857
#*# 	-0.267173, 0.005170, 0.069164, 0.082008, 0.097256, 0.094451, 0.089827, 0.082929, 0.066055, 0.054615, 0.048130, 0.032299, 0.020704, 0.000287, -0.011322, -0.024266, -0.039967, -0.055381, -0.066173, -0.076820, -0.077811, -0.084165, -0.098339, -0.109012, -0.122231, -0.150840, -0.163237, -0.200949, -0.240372, -0.283332
#*# 	-0.267558, 0.015517, 0.073415, 0.088953, 0.092940, 0.083404, 0.084820, 0.074752, 0.063640, 0.050937, 0.039930, 0.021070, 0.011676, -0.010885, -0.018515, -0.039494, -0.053231, -0.072257, -0.080484, -0.086885, -0.089309, -0.103672, -0.114635, -0.126578, -0.142478, -0.160049, -0.188440, -0.216286, -0.247856, -0.306138
#*# 	-0.230326, 0.015081, 0.080908, 0.098677, 0.097089, 0.094145, 0.085055, 0.078897, 0.060712, 0.050794, 0.033376, 0.018449, 0.006454, -0.008647, -0.032095, -0.042022, -0.053798, -0.081204, -0.088835, -0.104062, -0.103728, -0.115277, -0.126787, -0.142121, -0.157281, -0.187325, -0.210794, -0.243341, -0.273672, -0.327749
#*# 	-0.251947, 0.017730, 0.082441, 0.100934, 0.089756, 0.085331, 0.081492, 0.067003, 0.056718, 0.039485, 0.024748, 0.010077, -0.009853, -0.023657, -0.035686, -0.053518, -0.075236, -0.090488, -0.108325, -0.115425, -0.124302, -0.124460, -0.143968, -0.157342, -0.186108, -0.199773, -0.230155, -0.249622, -0.293343, -0.340946
#*# 	-0.229313, 0.032793, 0.090951, 0.096854, 0.099485, 0.092367, 0.080329, 0.070695, 0.055169, 0.039835, 0.013446, 0.005527, -0.019525, -0.035152, -0.044184, -0.071641, -0.082905, -0.099785, -0.120027, -0.131236, -0.139391, -0.151844, -0.160222, -0.175687, -0.201923, -0.217997, -0.251081, -0.278962, -0.314450, -0.368194
#*# 	-0.184878, 0.037751, 0.094657, 0.095624, 0.104112, 0.093612, 0.080006, 0.069894, 0.046470, 0.031412, 0.014363, -0.002262, -0.025234, -0.043952, -0.057555, -0.076110, -0.097375, -0.118971, -0.133787, -0.144709, -0.160551, -0.161359, -0.176203, -0.194701, -0.214249, -0.241376, -0.267915, -0.307653, -0.336482, -0.398530
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 190.0
#*# min_y = 10.0
#*# max_y = 177.0
#*#
#*# [input_shaper]
#*# shaper_type_x = 2hump_ei
#*# shaper_freq_x = 39.0
#*# shaper_type_y = mzv
#*# shaper_freq_y = 28.8
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 34.233
#*# pid_ki = 3.741
#*# pid_kd = 78.309
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 75.491
#*# pid_ki = 1.328
#*# pid_kd = 1072.913
#*#
#*# [scanner]
#*# mode = scan
