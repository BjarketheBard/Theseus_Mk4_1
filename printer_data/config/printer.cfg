# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

# Main printer config
[include stepper.cfg]
[include tmc2209.cfg]
#[include extruder.cfg]
#[include heater_bed.cfg]
[include fan.cfg]
[include macro.cfg]
[include KAMP_Settings.cfg]
#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

#[heater_fan fan1]
#pin: PA3

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

[mcu]
#serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_2E00370008504E5238363120-if00
canbus_uuid: ed4c95b3cf4d

[mcu scanner]
#canbus_uuid: 0ca8d67388c2 
serial: /dev/serial/by-id/usb-Cartographer_614e_32000700124330394D363620-if00
#    adjust to suit your scanner, if using usb change to serial

[scanner]
mcu: scanner            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                         
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: -23                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc      
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 110, 110    
#    set this to the middle of your bed
speed: 70
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 10, 10
mesh_max: 180, 177
probe_count: 30, 30
algorithm: bicubic

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105



[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_z_velocity: 10
max_z_accel: 120
square_corner_velocity: 10


[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

[extruder]
#E3D Revo Hemera XS
max_extrude_only_distance: 1000.0
step_pin: PB12
dir_pin: PB11
enable_pin: !PA8
microsteps: 16
rotation_distance: 8.073476064
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PC5
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA1
control: pid
pid_Kp: 26.949
pid_Ki: 1.497
pid_Kd: 121.269
min_temp: 0
max_temp: 300
pressure_advance: 0
max_extrude_cross_section: 5

[firmware_retraction]
retract_length: 0.2
retract_speed: 20
unretract_extra_length: 0
unretract_speed: 10

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

#[bltouch]
#sensor_pin: PC13
#control_pin: PC15
#x_offset: 0
#y_offset: -36.65
#z_offset: 1.40


#[bed_mesh]
#speed: 80
#horizontal_move_z: 5
#mesh_min: 5, 0
#mesh_max: 200, 163.35
#probe_count: 5, 5
#mesh_pps: 2, 2
#fade_start: 1
#fade_end: 10
#fade_target: 0
#adaptive_margin: 5

[bed_screws]
screw1: 10, 10
screw2: 194, 10
screw3: 194, 180
screw4: 10, 180

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
control: watermark
min_temp: 0
max_temp: 130

[gcode_arcs]

[filament_switch_sensor switch_sensor]
switch_pin: ^PC2  # switch sensor IO is PA0
pause_on_runout: False
runout_gcode:
    PAUSE  # [pause_resume] is required in printer.cfg
    M117 Filament switch runout
insert_gcode:
    M117 Filament switch inserted

[filament_motion_sensor encoder_sensor]
switch_pin: ^PC3  # motion sensor IO is PC2
detection_length: 2.88  # accuracy of motion sensor 2.88mm
extruder: extruder
pause_on_runout: False
runout_gcode:
    PAUSE  # [pause_resume] is required in printer.cfg
    M117 Filament encoder runout
insert_gcode:
    M117 Filament encoder inserted




[safe_z_home]
home_xy_position: 110, 110 # Change coordinates to the center of your print bed
speed: 50
z_hop: 10                 # Move up 10mm
z_hop_speed: 5


[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

# Proximity switch
#[probe]
#pin: PC15

[neopixel my_neopixel]
pin: PC11
chain_count: 80
initial_RED: 0.2
initial_GREEN: 0.2
initial_BLUE: 0.2



#[neopixel my_neopixel2]
#pin: PC14

#[adxl345]
#cs_pin: PC0
#spi_bus: spi2

[virtual_sdcard]
path: /home/bryan/printer_data/gcodes

[display_status]

[pause_resume]

[exclude_object]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.4873154985922499,
#*# 	1.9410219018311106,
#*# 	0.7730901044127584,
#*# 	0.46814525357096853,
#*# 	0.5004984722212106,
#*# 	-0.04463954768673621,
#*# 	-0.6247582551635269,
#*# 	-0.04402818427018049,
#*# 	0.4130363307598241,
#*# 	0.13059432415666547
#*# model_domain = 3.210000100466014e-07,3.29729196113589e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 25.301296
#*# model_offset = 0.00000
#*# model_mode = scan
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, 4891987164938640744121087723162075968187292442357591115420145498575826858740905421908376091579530848465343184141486170853621173237328119376764428521525238174195880307871693827774279739339374615233256613800450927456685711819583028684922344235391119974727680.000000, 388906891401708301391473506575712700815616573887320488774833159327305282039743642531127238824876789610212797074431137102098377934304375631226980331632796336783657901293663030122348346116001873223775588624580293065736586445856905887744.000000, -0.113157, -0.113157, -873989987746428259412194333913416701987357762822590714399458303903535888835232670878457161432636363996257309241302481691723537010408733419813385804491106555801784494262060916206872597091033287849274902594962928694944169726768114734355431735427072.000000, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157
#*# 	  -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, -0.113157, 1674925824368868261030491559588406467957198573386110495342902248163467859345936524276519852360038294492429365424987616998253597754823853507271493606347071763352531973183124818154097833086058562440516732646801972959585323043723161536760045895680.000000, -0.113157, -0.113157, -1.966457, -1.080957, -1.059206, -1.089631, -1.128103, -1.179230, -1.223918, -1.273687, -1.328259, -1.380026, -1.421914, -1.460979, -1.511446, -1.570616, -1.709457, -2.829727, -338460661625641941692554321137681570761359740305126120350157424193715040470893940597884729946935698083405671404169357028229120.000000, 40018854044879524173187380907504364673397687384648884788643273301726485681999285997544718526447120951821786102634347631934572200567668246407425495662592.000000, 4786177155154218398834783501103588641254717850404988150116118251142546076324234467611541806929459465419791760068475594584030759446449849330362285625990026390259445917926412538347520.000000, 4913399896298631307206936551902304615085201034986472062885365467403040175784814407202916022341041866695006054110801792930228224517142849873359005896450117802557018410628324031388080599739413932749595505563468141667211701781015682929033634083351153344512.000000, -28961840942305209977367880492346344105930965384002479351021796306265364684419554212019431954346578296954957143852125314871197696.000000
#*# 	  461486434251031938379298364802197839234267120619778121946941652794052463232420279148354243873688176965241072232229671610484586738735311186988674349903133540148621331098768682065322141381273414881493745984335334621270230424792502497020298391502760044307957650668702811650538285826048.000000, 261611812099083498511191182162064133979985032114582850625424447134121598583226547910300265227337067323423684688338107322450185760547044556556037021836175179665082600253047333264969176469421045077125295366679394543935291678772365859978786512380670677667020800.000000, -2.335996, -2.262088, -2.272665, -2.288524, -2.323493, -2.368445, -1.725078, -0.463691, -0.216142, -0.192718, -0.213104, -0.242635, -0.273610, -0.308583, -0.339514, -0.379108, -0.405338, -0.438482, -0.467512, -0.500341, -0.540027, -0.651233, -1.095050, -2.750014, -0.113157, 71232638465321901089835923771408933863187898266434795373565999966320254897917563692661080064.000000, -0.113157, -338460674234226206756273419341565790932169463183857902124778387068026427446608531907990908982394335779994372386644601092440064.000000
#*# 	  -0.113157, -2.733329, -0.231273, -0.108708, -0.132639, -0.167762, -0.201355, -0.228538, -0.189736, -0.105243, -0.090732, -0.107620, -0.132206, -0.156765, -0.185606, -0.216409, -0.247732, -0.282766, -0.311202, -0.337115, -0.365101, -0.393884, -0.428299, -0.488114, -0.582821, -0.789121, -0.936753, -1.014971, -1.076631, -1.188912
#*# 	  -0.113157, -2.717664, -0.125482, 0.057208, 0.040013, 0.016751, -0.008840, -0.032374, -0.047016, -0.056982, -0.072021, -0.088639, -0.111949, -0.139945, -0.170371, -0.200818, -0.231027, -0.261822, -0.287575, -0.316190, -0.338696, -0.371186, -0.405022, -0.444705, -0.498086, -0.548789, -0.606397, -0.656078, -0.724356, -0.803251
#*# 	  -0.113157, -2.680445, -0.155204, 0.049612, 0.048644, 0.034969, 0.014888, -0.001261, -0.023471, -0.044397, -0.065608, -0.087836, -0.109549, -0.131911, -0.163521, -0.195308, -0.224542, -0.252216, -0.280417, -0.308873, -0.331144, -0.360838, -0.393411, -0.438584, -0.468831, -0.516132, -0.560673, -0.601291, -0.671920, -0.753129
#*# 	  -0.113157, -2.717537, -0.191619, 0.034515, 0.034758, 0.027627, 0.013315, -0.003961, -0.018173, -0.034441, -0.051459, -0.069431, -0.091499, -0.113150, -0.144112, -0.175202, -0.201805, -0.234028, -0.263760, -0.290964, -0.311803, -0.342360, -0.377113, -0.411246, -0.450237, -0.485347, -0.535335, -0.580747, -0.645754, -0.723283
#*# 	  -0.113157, -2.697760, -0.203325, 0.028542, 0.039778, 0.036302, 0.029116, 0.016759, -0.003543, -0.020401, -0.031645, -0.050158, -0.071061, -0.095541, -0.128873, -0.163067, -0.190209, -0.227053, -0.252559, -0.276982, -0.296626, -0.325026, -0.356823, -0.392289, -0.428623, -0.470076, -0.514226, -0.559617, -0.630094, -0.705841
#*# 	  -0.113157, -2.717216, -0.211895, 0.018234, 0.036471, 0.037260, 0.030297, 0.016348, 0.001882, -0.010474, -0.024242, -0.037176, -0.058141, -0.082408, -0.109673, -0.142521, -0.173772, -0.197687, -0.227194, -0.255332, -0.274556, -0.309259, -0.331434, -0.370806, -0.404941, -0.437404, -0.485238, -0.530259, -0.593808, -0.673692
#*# 	  -10111089168768935662197872692196362898115640744623948349170195126576180818993239564280832589495616080276540457429330233473082537583522607387884183581637976565141972651762968740958017050361802077533275650441182301974010409771314708480.000000, -2.709601, -0.212770, 0.016882, 0.037080, 0.041677, 0.028640, 0.024278, 0.007724, -0.007692, -0.023506, -0.039789, -0.056358, -0.082069, -0.110206, -0.139312, -0.171094, -0.195481, -0.218126, -0.248675, -0.270059, -0.297631, -0.318626, -0.351783, -0.391020, -0.430651, -0.470576, -0.518961, -0.583568, -0.662091
#*# 	  435758612501822221465346755317772172148222220245191320948401802507844937370974459453528510167015271679880212633523341487542498705912352382273333902835264569099470401332289423143682022203078688329091141100566771560753540995843872176432720477196283543552.000000, -2.693153, -0.223401, 0.004665, 0.027864, 0.030261, 0.027084, 0.015639, 0.008429, -0.012662, -0.024166, -0.037778, -0.057973, -0.079867, -0.106759, -0.134216, -0.159390, -0.184291, -0.209755, -0.241121, -0.268075, -0.297371, -0.321375, -0.346813, -0.380847, -0.422725, -0.459869, -0.509304, -0.567315, -0.651686
#*# 	  -0.113157, -2.688769, -0.222687, 0.005306, 0.027129, 0.032935, 0.023679, 0.024682, 0.009762, -0.014746, -0.029555, -0.042325, -0.063261, -0.083017, -0.112839, -0.138944, -0.167801, -0.198313, -0.219435, -0.245498, -0.270657, -0.290854, -0.317974, -0.351361, -0.381226, -0.424857, -0.461577, -0.507971, -0.572751, -0.653427
#*# 	  -0.113157, -2.701052, -0.238640, -0.005564, 0.016342, 0.021513, 0.014211, 0.008282, -0.006558, -0.016584, -0.029396, -0.049661, -0.068488, -0.089377, -0.116203, -0.140646, -0.164237, -0.186821, -0.211595, -0.242321, -0.265127, -0.297526, -0.313386, -0.338129, -0.373198, -0.408830, -0.451919, -0.497217, -0.562106, -0.645533
#*# 	  -0.113157, -2.655620, -0.220345, -0.003215, 0.022699, 0.027628, 0.033667, 0.024367, 0.008370, -0.008320, -0.025653, -0.043136, -0.061421, -0.084550, -0.108753, -0.139236, -0.159988, -0.192227, -0.210955, -0.232048, -0.252140, -0.288479, -0.299623, -0.334842, -0.366322, -0.406701, -0.436049, -0.494350, -0.549622, -0.637424
#*# 	  -63285714876796969814476152567468565164854727891176270142976388860785087384614818037261749689976865992012922427621535623197753344.000000, -2.670962, -0.207302, 0.016362, 0.038155, 0.047707, 0.049176, 0.034636, 0.024758, 0.008811, -0.010473, -0.027245, -0.044485, -0.069005, -0.093675, -0.118135, -0.142409, -0.164492, -0.189499, -0.210824, -0.245138, -0.262555, -0.291598, -0.315826, -0.346171, -0.379220, -0.415032, -0.466379, -0.531559, -0.618180
#*# 	  -0.113157, -2.644266, -0.183877, 0.040908, 0.066046, 0.068186, 0.077406, 0.064186, 0.055626, 0.036142, 0.013314, -0.006851, -0.024087, -0.049833, -0.074050, -0.102793, -0.129713, -0.155564, -0.178992, -0.194674, -0.217743, -0.253749, -0.274544, -0.300142, -0.327227, -0.358663, -0.404927, -0.456164, -0.508805, -0.595079
#*# 	  -0.113157, -2.614160, -0.152291, 0.068239, 0.087251, 0.097702, 0.097143, 0.087480, 0.080599, 0.065281, 0.045732, 0.025245, 0.000940, -0.023597, -0.052627, -0.077125, -0.099535, -0.123782, -0.151690, -0.180888, -0.194724, -0.223787, -0.246506, -0.263326, -0.299034, -0.328437, -0.369162, -0.420471, -0.485177, -0.568180
#*# 	  -0.113157, -2.579327, -0.120498, 0.090032, 0.116083, 0.124880, 0.123150, 0.124261, 0.104637, 0.086868, 0.065270, 0.049228, 0.026414, 0.000535, -0.032252, -0.062989, -0.093471, -0.118645, -0.139215, -0.157698, -0.181221, -0.211214, -0.223794, -0.257113, -0.279408, -0.310650, -0.353771, -0.406319, -0.460681, -0.555473
#*# 	  -0.113157, -2.571920, -0.111635, 0.098480, 0.120759, 0.131204, 0.134215, 0.127339, 0.114854, 0.102444, 0.081162, 0.061617, 0.028892, 0.004280, -0.021601, -0.052544, -0.072658, -0.097391, -0.127645, -0.159623, -0.182561, -0.199019, -0.224138, -0.248344, -0.277840, -0.313386, -0.358425, -0.406707, -0.468789, -0.547696
#*# 	  -0.113157, -2.538114, -0.095348, 0.110145, 0.129887, 0.142444, 0.140070, 0.132685, 0.119843, 0.096531, 0.083362, 0.062887, 0.032784, 0.005090, -0.020737, -0.051165, -0.080712, -0.105109, -0.134395, -0.154310, -0.184478, -0.210148, -0.231166, -0.261407, -0.281623, -0.317312, -0.353801, -0.404676, -0.473247, -0.552759
#*# 	  59389367648338167005413579706939227660542706215070996740032047739221033857839263515506746646554004679680353215680350900623749161713645177031536832860853323262990501916544657514823264014541340227891397330662408754002439855605821930191679839567114928128.000000, -2.522102, -0.082999, 0.119973, 0.141936, 0.148583, 0.148361, 0.137852, 0.125854, 0.105807, 0.085587, 0.065553, 0.034876, 0.010817, -0.013308, -0.042059, -0.068711, -0.102644, -0.121326, -0.154780, -0.182362, -0.207743, -0.230529, -0.258067, -0.287251, -0.321776, -0.363558, -0.413750, -0.471371, -0.557108
#*# 	  -0.113157, -2.518775, -0.072427, 0.133650, 0.157102, 0.165842, 0.160657, 0.144823, 0.129411, 0.109291, 0.087565, 0.063716, 0.036218, 0.009957, -0.016583, -0.046948, -0.071739, -0.101171, -0.125517, -0.154508, -0.181533, -0.216320, -0.225325, -0.254565, -0.288069, -0.320926, -0.362522, -0.413135, -0.478971, -0.560217
#*# 	  -0.113157, -2.496836, -0.054761, 0.153871, 0.178165, 0.185634, 0.173333, 0.155492, 0.139339, 0.117681, 0.095193, 0.073190, 0.043509, 0.014521, -0.010303, -0.050602, -0.065663, -0.092882, -0.132274, -0.156619, -0.186909, -0.210693, -0.236752, -0.269696, -0.294529, -0.324170, -0.365041, -0.414250, -0.480332, -0.563723
#*# 	  -0.113157, -2.481721, -0.024467, 0.168383, 0.186438, 0.191779, 0.184298, 0.164873, 0.146144, 0.122192, 0.098913, 0.071692, 0.049844, 0.020690, -0.006623, -0.035018, -0.058566, -0.090687, -0.125693, -0.158248, -0.192314, -0.220205, -0.241012, -0.267564, -0.289805, -0.328096, -0.370205, -0.413359, -0.485301, -0.562313
#*# 	  5290611483022556254908389298354386929186021415114462511445535868177389715888297219959846640670778686815551212272346165441324570844338323291543499065908622369879809790512880836149248.000000, -2.508749, -0.012823, 0.185204, 0.199116, 0.203030, 0.189473, 0.175037, 0.155531, 0.132386, 0.108049, 0.079094, 0.059736, 0.030019, 0.004628, -0.007495, -0.060775, -0.091438, -0.120883, -0.149338, -0.186304, -0.203035, -0.227946, -0.257179, -0.287821, -0.328781, -0.370264, -0.419297, -0.478694, -0.563874
#*# 	  -243379301485947953274895546392285379684656945545434041491924056114613830822184196899139314777940232835006314430617872998462106871377807538849230048062979277053535828259869682287876940250892255380020578126688030427015459567028265811968.000000, -2.451191, 0.005350, 0.204167, 0.217745, 0.219998, 0.204906, 0.186208, 0.170185, 0.138762, 0.112251, 0.087740, 0.059437, 0.036689, 0.008259, -0.017240, -0.055299, -0.089671, -0.126289, -0.152255, -0.179545, -0.210837, -0.236784, -0.259701, -0.299069, -0.326293, -0.371800, -0.419533, -0.481219, -0.571299
#*# 	  66776585599437236248856596311956467972304507320905196062968258603565585340756077575906787328.000000, -2.433646, 0.054548, 0.249009, 0.263655, 0.256535, 0.243550, 0.228044, 0.204905, 0.178156, 0.151668, 0.131553, 0.099434, 0.078669, 0.026107, -0.002567, -0.028514, -0.051130, -0.094789, -0.118110, -0.150114, -0.178841, -0.201608, -0.235129, -0.269800, -0.307602, -0.349823, -0.398056, -0.464764, -0.558531
#*# 	  -0.113157, -2.405594, 0.088234, 0.284713, 0.295412, 0.289189, 0.272756, 0.248485, 0.223728, 0.196430, 0.172496, 0.143853, 0.118005, 0.084081, 0.057950, 0.023077, -0.012803, -0.045065, -0.079090, -0.108401, -0.134791, -0.152094, -0.193107, -0.229601, -0.265867, -0.298416, -0.341430, -0.397034, -0.463163, -0.554892
#*# 	  -0.113157, -2.395796, 0.127216, 0.318255, 0.324482, 0.313807, 0.293724, 0.273184, 0.249760, 0.220833, 0.188232, 0.168287, 0.131854, 0.105831, 0.056131, 0.036651, -0.009464, -0.039353, -0.065460, -0.094756, -0.116904, -0.155609, -0.185248, -0.217118, -0.241681, -0.292914, -0.335045, -0.387366, -0.462666, -0.551130
#*# 	  -0.113157, -2.387773, 0.157864, 0.342902, 0.344649, 0.334071, 0.311435, 0.284507, 0.261640, 0.231159, 0.203574, 0.171620, 0.143680, 0.114149, 0.073316, 0.039892, 0.004677, -0.032617, -0.060517, -0.089575, -0.114868, -0.156625, -0.183784, -0.214397, -0.247973, -0.290431, -0.334411, -0.396759, -0.462275, -0.556537
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 240.0
#*# min_y = 6.0
#*# max_y = 198.0
